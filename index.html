<!DOCTYPE html>
<html>

<head>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: hsl(0, 0%, 94%);
        }

        canvas {
            height: 90vh;
            width: 45vh;
            background: hsl(0, 0%, 90%);
        }
    </style>
</head>

<body>
    <canvas width="256" height="512"></canvas>
    <script>
        const [canvas, ctx] = [document.querySelector('canvas'), document.querySelector('canvas').getContext('2d')];

        class Input {
            static DIRECTIONS = { LEFT: 4, RIGHT: 6, UP: 8, DOWN: 2, TAP: 5 };
            static THRESHOLD = 10;

            #inputQueue = [];
            #startPos = null;
            #hasMoved = false;

            constructor() {
                addEventListener('mousedown', this.#handleMouseDown.bind(this));
                addEventListener('mousemove', this.#handleMouseMove.bind(this));
                addEventListener('mouseup', this.#handleMouseUp.bind(this));
            }

            #handleMouseDown(e) {
                this.#startPos = { x: e.clientX, y: e.clientY };
                this.#hasMoved = false;
            }

            #handleMouseMove(e) {
                if (!this.#startPos) return;

                const dx = e.clientX - this.#startPos.x;
                const dy = e.clientY - this.#startPos.y;

                if (Math.abs(dx) > Input.THRESHOLD || Math.abs(dy) > Input.THRESHOLD) {
                    this.#hasMoved = true;
                    this.#addDirectionInput(dx, dy);
                    this.#updateStartPos(e.clientX, e.clientY, dx, dy);
                }
            }

            #handleMouseUp() {
                if (!this.#hasMoved) {
                    this.#inputQueue.push(Input.DIRECTIONS.TAP);
                }
                this.#startPos = null;
            }

            #addDirectionInput(dx, dy) {
                if (Math.abs(dx) > Math.abs(dy)) {
                    this.#inputQueue.push(dx > 0 ? Input.DIRECTIONS.RIGHT : Input.DIRECTIONS.LEFT);
                } else {
                    this.#inputQueue.push(dy > 0 ? Input.DIRECTIONS.DOWN : Input.DIRECTIONS.UP);
                }
            }

            #updateStartPos(clientX, clientY, dx, dy) {
                if (Math.abs(dx) > Math.abs(dy)) {
                    this.#startPos.x = clientX;
                } else {
                    this.#startPos.y = clientY;
                }
            }

            getInput() {
                return this.#inputQueue.shift() || null;
            }
        }

        const controller = new Input();

        const gameLoop = () => {
            console.log(new Date().toLocaleTimeString());
            setTimeout(gameLoop, 33);
        };

        gameLoop();
    </script>
</body>

</html>